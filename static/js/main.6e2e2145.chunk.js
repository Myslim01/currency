(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{45:function(e,t,n){e.exports=n.p+"static/media/logo.4c512146.svg"},46:function(e,t,n){e.exports=n(76)},73:function(e,t,n){},74:function(e,t,n){},75:function(e,t,n){},76:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(23),o=n.n(c),i=n(9),u=n(26),s=n(24),l=n(34),p=n(35),h=[{name:"currency",path:"/currency"},{name:"about",path:"/about"}];var d=n(27),v=n.n(d),m=n(36),f=n.n(m),b="currency_rates.CBR_DAILY_FETCHED",y="currency_rates.USD_EUR_RATE_FETCHED",g=v()({currencyRates:void 0});function _(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t.type){case b:return e.merge({cbrDaily:t.daily});case y:return e.merge({usdEurRate:t.daily});default:return e}}function C(e){return e.currencyRates.cbrDaily}function E(e){return e.currencyRates.usdEurRate}function k(e){return e.currencyRates.cbrDaily?f.a.keyBy(e.currencyRates.cbrDaily.Valute,function(e){return e.CharCode}):[]}var w="vk.accessTokenFetched",j="vk.accessTokenFailed",O="vk.notificationsStatusFetched",A="vk.notificationsStatusFailed",S="vk.insetsFetched",R=v()({vk:void 0});function D(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t.type){case w:return e.merge({accessToken:t.accessToken});case O:return e.merge({notificationStatus:t.notificationStatus});case S:return e.merge({insets:t.insets});case j:case A:return e.merge({logs:t.error});default:return e}}function N(e){return e.vk.accessToken}function P(e){return e.vk.notificationStatus}function T(e){return e.vk.insets}function x(e){return JSON.stringify(e.vk.logs)}var V=n(20),U=n(31),W=n(37),B=n(38);var F=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function I(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}var L=n(7),M=n(8),K=n(11),G=n(10),H=n(12),q=n(1),z=(n(22),n(39)),Y=n(2),$=n.n(Y),J=n(13),Q=n(14),X="5.80";function Z(){return Object(J.a)($.a.mark(function e(){return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:6625834,Q.send("VKWebAppGetAuthToken",{app_id:6625834});case 2:case"end":return e.stop()}},e)}))}function ee(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,c=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString();if(void 0!==r||void 0!==a){var o=function(e){var t=e.detail;if(t){var n=t.type,i=t.data,u=!1;"VKWebAppCallAPIMethodResult"===n&&i.request_id===c?(void 0!==r&&r(i.response),u=!0):"VKWebAppCallAPIMethodFailed"===n&&i.request_id===c&&(void 0!==a&&a(i),u=!0),u&&Q.unsubscribe(o)}else console.error("invalid event",e)};Q.subscribe(o)}t.access_token=n,void 0===t.v&&(t.v=X),Q.send("VKWebAppCallAPIMethod",{method:e,params:t,request_id:c})}var te=n(40),ne=n.n(te),re=n(29),ae=n.n(re),ce=(n(73),n(41)),oe=n.n(ce),ie=function(e){function t(){return Object(L.a)(this,t),Object(K.a)(this,Object(G.a)(t).apply(this,arguments))}return Object(H.a)(t,e),Object(M.a)(t,[{key:"render",value:function(){return a.a.createElement(q.Div,{className:"footer"},a.a.createElement(q.Button,{level:"3",component:"a",target:"_blank",href:"https://vk.me/currency_app",before:a.a.createElement(oe.a,null)}),a.a.createElement(q.Button,{level:"3",component:"a",target:"_blank",href:"https://vk.com/currency_app"},"\u0413\u0440\u0443\u043f\u043f\u0430"),a.a.createElement(q.Button,{level:"3",component:"a",onClick:this.openAbout.bind(this)},"\u041e \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0435"))}},{key:"openAbout",value:function(){this.props.router.navigate("about")}}]),t}(r.Component);var ue=Object(i.b)(function(e){return{}})(ie),se=function(e){function t(){return Object(L.a)(this,t),Object(K.a)(this,Object(G.a)(t).apply(this,arguments))}return Object(H.a)(t,e),Object(M.a)(t,[{key:"render",value:function(){var e=Object(q.platform)();return a.a.createElement(q.Panel,{id:this.props.id},a.a.createElement(q.PanelHeader,{left:a.a.createElement(q.HeaderButton,{onClick:this.navigationBack.bind(this)},e===q.IOS?a.a.createElement(ne.a,null):a.a.createElement(ae.a,null))},"\u041e \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0435"),a.a.createElement(q.Group,{title:"\u0418\u0441\u0445\u043e\u0434\u043d\u044b\u0439 \u043a\u043e\u0434"},a.a.createElement(q.Div,null,"\u0418\u0441\u0445\u043e\u0434\u043d\u044b\u0439 \u043a\u043e\u0434 \u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d \u043d\u0430 ",a.a.createElement(q.Link,{href:"https://github.com/tsivarev/currency"},"GitHub"),".",a.a.createElement("br",null),a.a.createElement("br",null),"\u0414\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u044f ",a.a.createElement(q.Link,{href:"https://vk.com/dev/vk_apps_docs"},"VK Apps \u043f\u043b\u0430\u0442\u0444\u043e\u0440\u043c\u044b"),".")),a.a.createElement(q.Group,{title:"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c\u044b\u0435 \u0440\u0435\u0441\u0443\u0440\u0441\u044b"},a.a.createElement(q.List,null,a.a.createElement(q.Cell,{multiline:!0},"\u0418\u043a\u043e\u043d\u043a\u0438 \u2013 ",a.a.createElement(q.Link,{href:"https://www.flaticon.com/authors/smashicons"},"Smashicons"),". \u041b\u0438\u0446\u0435\u043d\u0437\u0438\u044f ",a.a.createElement(q.Link,{href:"http://creativecommons.org/licenses/by/3.0/"},"CC 3.0 BY"),"."),a.a.createElement(q.Cell,{multiline:!0},"\u041a\u0443\u0440\u0441\u044b \u0426\u0411 \u0420\u0424 \u2013 ",a.a.createElement(q.Link,{href:"https://www.cbr-xml-daily.ru/"},"API"),"."),a.a.createElement(q.Cell,{multiline:!0},"\u041a\u0443\u0440\u0441 USD/EUR \u2013 ",a.a.createElement(q.Link,{href:"https://free.currencyconverterapi.com/"},"API"),"."))),a.a.createElement(ue,{router:this.props.router}))}},{key:"navigationBack",value:function(){this.props.router.navigate("currency")}}]),t}(r.Component);var le=Object(i.b)(function(e){return{}})(se),pe=n(42),he=n.n(pe),de=n(43),ve=n.n(de),me=n(44),fe=n.n(me),be=n(45),ye=n.n(be),ge=n(16),_e=(n(74),function(e){function t(e){var n;return Object(L.a)(this,t),(n=Object(K.a)(this,Object(G.a)(t).call(this,e))).renderRow=n.renderRow.bind(Object(ge.a)(n)),n}return Object(H.a)(t,e),Object(M.a)(t,[{key:"getPrettyDate",value:function(e){var t=new Date(Date.parse(e)),n=t.getDate(),r=t.getMonth(),a=t.getFullYear();return("0"+n).slice(-2)+"."+("0"+(r+1)).slice(-2)+"."+a.toString().substr(-2)}},{key:"render",value:function(){if(!this.props.rates)return a.a.createElement(q.Div,null);var e=this.getPrettyDate(this.props.rates.Date),t=this.getPrettyDate(this.props.rates.PreviousDate);return a.a.createElement(q.List,null,a.a.createElement(q.Cell,{before:a.a.createElement("div",{className:"currency_rate_dashboard__item_before"})},a.a.createElement("div",{className:"currency_rate_dashboard__item"},a.a.createElement("div",{className:"currency_rate_dashboard__item__column currency_rate_dashboard__header"},e),a.a.createElement("div",{className:"currency_rate_dashboard__item__column currency_rate_dashboard__header"},t))),this.renderRow("$",this.props.cbrCurrencies.USD),this.renderRow("\u20ac",this.props.cbrCurrencies.EUR))}},{key:"renderRow",value:function(e,t){var n=t.Value>t.Previous,r=n?"#1BEA60":"#FF0000",c=n?"\u2191":"\u2193";return a.a.createElement(q.Cell,{before:a.a.createElement("div",{className:"currency_rate_dashboard__item_before"},e)},a.a.createElement("div",{className:"currency_rate_dashboard__item"},a.a.createElement("div",{className:"currency_rate_dashboard__item__column",style:{color:r}},t.Value," \u20bd ",c),a.a.createElement("div",{className:"currency_rate_dashboard__item__column"},t.Previous," \u20bd")))}}]),t}(r.Component));var Ce=Object(i.b)(function(e){return{rates:C(e),cbrCurrencies:k(e)}})(_e),Ee=(n(75),"USD"),ke="RUB",we="EUR",je=function(e){function t(e){var n;return Object(L.a)(this,t),(n=Object(K.a)(this,Object(G.a)(t).call(this,e))).state={sourceCurrencyCode:Ee,targetCurrencyCode:ke,amount:0,convertedAmount:"0"},n.changeSourceCurrencyCode=n.changeSourceCurrencyCode.bind(Object(ge.a)(n)),n.changeTargetCurrencyCode=n.changeTargetCurrencyCode.bind(Object(ge.a)(n)),n.changeAmount=n.changeAmount.bind(Object(ge.a)(n)),n.getCurrencyRate=n.getCurrencyRate.bind(Object(ge.a)(n)),n.calculateAmount=n.calculateAmount.bind(Object(ge.a)(n)),n}return Object(H.a)(t,e),Object(M.a)(t,[{key:"changeSourceCurrencyCode",value:function(e){var t=this.state.targetCurrencyCode,n=e.target.value;this.state.targetCurrencyCode===e.target.value&&(t=this.state.sourceCurrencyCode),this.setState({sourceCurrencyCode:n,targetCurrencyCode:t,convertedAmount:this.calculateAmount(this.state.amount,n,t)})}},{key:"changeTargetCurrencyCode",value:function(e){var t=e.target.value,n=this.state.sourceCurrencyCode;this.state.sourceCurrencyCode===e.target.value&&(n=this.state.targetCurrencyCode),this.setState({sourceCurrencyCode:n,targetCurrencyCode:t,convertedAmount:this.calculateAmount(this.state.amount,n,t)})}},{key:"getCurrencyRate",value:function(e,t){return this.props.cbrCurrencies?e===ke?this.props.cbrCurrencies[t]?1/this.props.cbrCurrencies[t].Value:1:t===ke?this.props.cbrCurrencies[e]?this.props.cbrCurrencies[e].Value:1:t===Ee?1/this.props.usdEurRate.USD_EUR.val:t===we?this.props.usdEurRate.USD_EUR.val:1:1}},{key:"calculateAmount",value:function(e,t,n){return this.getCurrencyRate(t,n)*e}},{key:"getPrettyAmount",value:function(e){return(Math.round(e*Math.pow(10,2))/Math.pow(10,2)).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")}},{key:"changeAmount",value:function(e){this.setState({amount:e.target.value,convertedAmount:this.calculateAmount(e.target.value,this.state.sourceCurrencyCode,this.state.targetCurrencyCode)})}},{key:"getCurrencySymbol",value:function(e){switch(e){case Ee:return"$";case we:return"\u20ac";case ke:return"\u20bd";default:return""}}},{key:"render",value:function(){return a.a.createElement(q.Div,{className:"currency_converter"},a.a.createElement("div",{style:{color:"#71757A"}},"\u041a\u0443\u0440\u0441 1 ",this.getCurrencySymbol(this.state.sourceCurrencyCode)," = ",this.getPrettyAmount(this.getCurrencyRate(this.state.sourceCurrencyCode,this.state.targetCurrencyCode))," ",this.getCurrencySymbol(this.state.targetCurrencyCode)),a.a.createElement("div",{className:"currency_converter__amount_input"},a.a.createElement("div",{className:"currency_converter__amount_input__input"},a.a.createElement(q.Input,{type:"number",placeholder:"0",pattern:"\\d*",value:this.state.amount?this.state.amount.toLocaleString():"",alignment:"right",onChange:this.changeAmount})),a.a.createElement("div",{className:"currency_converter__amount_input__selector"},a.a.createElement(q.Select,{value:this.state.sourceCurrencyCode,onChange:this.changeSourceCurrencyCode},a.a.createElement("option",{value:Ee},this.getCurrencySymbol(Ee)),a.a.createElement("option",{value:we},this.getCurrencySymbol(we)),a.a.createElement("option",{value:ke},this.getCurrencySymbol(ke))))),a.a.createElement("div",{className:"currency_converter__amount_input"},a.a.createElement("div",{className:"currency_converter__amount_input__input"},a.a.createElement(q.Input,{type:"text",alignment:"right",disabled:!0,value:this.getPrettyAmount(this.state.convertedAmount)})),a.a.createElement("div",{className:"currency_converter__amount_input__selector"},a.a.createElement(q.Select,{value:this.state.targetCurrencyCode,onChange:this.changeTargetCurrencyCode},a.a.createElement("option",{value:Ee},this.getCurrencySymbol(Ee)),a.a.createElement("option",{value:we},this.getCurrencySymbol(we)),a.a.createElement("option",{value:ke},this.getCurrencySymbol(ke))))))}}]),t}(r.Component);var Oe=Object(i.b)(function(e){return{cbrCurrencies:k(e),usdEurRate:E(e)}})(je),Ae=new(function(){function e(){Object(L.a)(this,e)}return Object(M.a)(e,[{key:"getDaily",value:function(){var e=Object(J.a)($.a.mark(function e(t){var n;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getDate()+"_"+(t.getMonth()+1)+"_"+t.getFullYear(),e.abrupt("return",fetch("https://www.cbr-xml-daily.ru/daily_json.js?"+n).then(function(e){return e.json()}));case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}],[{key:"pad",value:function(e){return e<10?"0"+e:e}}]),e}()),Se=new(function(){function e(){Object(L.a)(this,e)}return Object(M.a)(e,[{key:"getUsdEurRate",value:function(){var e=Object(J.a)($.a.mark(function e(){return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("https://free.currencyconverterapi.com/api/v5/convert?q=USD_EUR&compact=y").then(function(e){return e.json()}));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]),e}());var Re=function(e){function t(){return Object(L.a)(this,t),Object(K.a)(this,Object(G.a)(t).apply(this,arguments))}return Object(H.a)(t,e),Object(M.a)(t,[{key:"render",value:function(){return a.a.createElement(q.Div,null,this.props.logs)}}]),t}(r.Component);Object(i.b)(function(e){return{logs:x(e)}})(Re);var De=function(e){function t(){return Object(L.a)(this,t),Object(K.a)(this,Object(G.a)(t).apply(this,arguments))}return Object(H.a)(t,e),Object(M.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(function(){var e=Object(J.a)($.a.mark(function e(t,n){var r;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Se.getUsdEurRate();case 3:r=e.sent,t({type:y,daily:r}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}},e,null,[[0,7]])}));return function(t,n){return e.apply(this,arguments)}}()),this.props.dispatch(function(){var e=Object(J.a)($.a.mark(function e(t,n){var r,a;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new Date,e.next=4,Ae.getDaily(r);case 4:a=e.sent,t({type:b,daily:a}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0);case 11:case"end":return e.stop()}},e,null,[[0,8]])}));return function(t,n){return e.apply(this,arguments)}}())}},{key:"componentDidUpdate",value:function(){var e;this.props.accessToken&&this.props.dispatch((e=this.props.accessToken,function(){var t=Object(J.a)($.a.mark(function t(n){return $.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:ee("apps.isNotificationsAllowed",{},e,function(e){n({type:O,notificationStatus:e.is_allowed})},function(e){n({type:A,error:e})});case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()))}},{key:"render",value:function(){var e=null;return a.a.createElement(q.Panel,{id:this.props.id},a.a.createElement(q.PanelHeader,null,"\u041a\u0443\u0440\u0441\u044b \u0432\u0430\u043b\u044e\u0442"),a.a.createElement(q.Div,{style:{textAlign:"center",marginTop:10}},a.a.createElement("img",{width:96,height:96,src:ye.a,alt:"logo"})),a.a.createElement(q.Group,{title:"\u041a\u0443\u0440\u0441 \u0426\u0411 \u0420\u0424"},a.a.createElement(Ce,null),this.renderNotificationButton()),a.a.createElement(q.Group,{title:"\u041a\u0430\u043b\u044c\u043a\u0443\u043b\u044f\u0442\u043e\u0440"},a.a.createElement(Oe,null)),a.a.createElement(ue,{router:this.props.router}),e)}},{key:"renderNotificationButton",value:function(){var e=this.props.notificationStatus;return this.props.accessToken&&void 0!==e?a.a.createElement(q.Div,null,a.a.createElement(q.Button,{before:e?a.a.createElement(ve.a,null):a.a.createElement(he.a,null),level:e?"2":"1",size:"xl",onClick:this.toggleNotifications.bind(this)},e?"\u041e\u0442\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f":"\u041f\u043e\u0434\u043f\u0438\u0441\u0430\u0442\u044c\u0441\u044f")):a.a.createElement(q.Div,null,a.a.createElement(q.Button,{before:a.a.createElement(fe.a,null),level:"1",size:"xl",onClick:this.authorize.bind(this)},"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f"))}},{key:"authorize",value:function(){this.props.dispatch(Z())}},{key:"toggleNotifications",value:function(){this.props.notificationStatus?this.props.dispatch(Object(J.a)($.a.mark(function e(){return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Q.send("VKWebAppDenyNotifications",{});case 1:case"end":return e.stop()}},e)}))):this.props.dispatch(Object(J.a)($.a.mark(function e(){return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Q.send("VKWebAppAllowNotifications",{});case 1:case"end":return e.stop()}},e)})))}}]),t}(r.Component);var Ne=Object(i.b)(function(e){return{notificationStatus:P(e)}})(De),Pe=function(e){function t(){return Object(L.a)(this,t),Object(K.a)(this,Object(G.a)(t).apply(this,arguments))}return Object(H.a)(t,e),Object(M.a)(t,[{key:"componentWillMount",value:function(){this.props.dispatch(function(){var e=Object(J.a)($.a.mark(function e(t){return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Q.subscribe(function(e){var n=e.detail;if(n){var r=n.type,a=n.data;switch(r){case"VKWebAppAllowNotificationsResult":t({type:O,notificationStatus:!0});break;case"VKWebAppDenyNotificationsResult":t({type:O,notificationStatus:!1});break;case"VKWebAppAccessTokenReceived":t({type:w,accessToken:a.access_token});break;case"VKWebAppUpdateInsets":t({type:S,insets:a.insets})}}else console.error("invalid event",e)}),Q.send("VKWebAppInit",{no_toolbar:!0});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),this.props.dispatch(Z())}},{key:"render",value:function(){var e="about"===this.props.route.name?"aboutPanel":"mainPanel";return a.a.createElement(q.ConfigProvider,{insets:this.props.insets,isWebView:z.a},a.a.createElement(q.Root,{activeView:"mainView"},a.a.createElement(q.View,{id:"mainView",activePanel:e},a.a.createElement(Ne,{router:this.props.router,id:"mainPanel",accessToken:this.props.accessToken}),a.a.createElement(le,{router:this.props.router,id:"aboutPanel"}))))}}]),t}(r.Component);var Te=Object(i.b)(function(e){return{accessToken:N(e),insets:T(e)}})(function(e){return a.a.createElement(u.a,{nodeName:""},function(t){var n=t.route;return a.a.createElement(Pe,Object.assign({route:n},e))})}),xe=function(){var e=Object(s.b)(h,{defaultRoute:"currency"});return e.usePlugin(l.a),e.usePlugin(Object(p.a)({useHash:!0})),e}(),Ve=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(V.a)(B.a,Object(U.a)(e),Object(W.createLogger)())(V.d)(Object(V.c)({router:U.b,currencyRates:_,vk:D}),t);return window.store=n,n}(xe);xe.start(function(){o.a.render(a.a.createElement(i.a,{store:Ve},a.a.createElement(u.b,{router:xe},a.a.createElement(Te,{router:xe}))),document.getElementById("root"))}),function(){if("serviceWorker"in navigator){if(new URL("/currency",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/currency","/service-worker.js");F?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):I(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):I(e)})}}()}},[[46,1,2]]]);
//# sourceMappingURL=main.6e2e2145.chunk.js.map